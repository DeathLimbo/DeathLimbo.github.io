---
layout: post 
title: mysql-索引
date: 2021-1-29
categories: mysql
tags: [mysql,index]
description: 文章金句。
---
#                                       索引介绍                        #
-------------------------------------------------------------------------<br>
## 索引是什么 ##
索引相当于字典的目录，是为了帮组mysql更快的查询到数据的一种数据结构。<br>
索引一般来说时存储在磁盘上的文件但中的，我们通常说的索引，包括聚集索引、覆盖索引、组合索引、前缀索引、唯一索引等，没有特别说明，默认都是使用B+树结构组织的索引.<br>
## 索引的优势劣势 ##
### 优势 ### 
 ·可以提高数据检索效率，减少磁盘io成本<br>
 ·通过索引列对数据进行排序，降低数据排序成本，降低cpu的消耗<br>
      ·被索引的列会自动经行排序，包括单列索引、组合索引，只是组合索引的排序要复杂一些<br>
      ·如果按照索引列的顺序进行排序，对应order by来说 ，效率就会提高很多<br>
### 劣势 ###
 ·索引会占磁盘空间<br>
 ·索引虽然会提高查询效率，但是会降低更新表的效率<br>
 
#                                      索引类型                          #
----------------------------------------------------------------------------<br>
## 主键索引 ##
索引列的值必须是唯一的，不允许为空值
## 普通索引 ##
mysql的基本类型索引，没有什么限制，允许定义索引的列中插入重复值和空值
## 唯一索引 ##
索引列必须唯一，但是允许空值
## 全文索引 ## 
只能在char、varchar、text类型字段上创建全文索引，如果字段长度比较大时，如果创建普通索引，在进行like模糊查询的时候效率较低，这个时候可以创建全文索引，myisam和innodb中都可以使用全文索引
## 空间索引 ##
MySQL在5.7之后的版本支持了空间索引，而且支持OpenGIS几何数据模型。MySQL在空间索引这方面遵循OpenGIS几何数据模型规则
## 前缀索引 ##
在文本类型如char、varchar、text类列上创建索引时，可以指定索引列的长度，但是数值类型不能指定
## 其他 ##
1、单列索引<br>
2、组合索引<br>
   组合索引的使用，需要遵循<h2>最左前缀匹配原则</h2>。一般情况下在条件运行的情况下使用组合索引代替多个单列索引
#                                      索引的数据结构                          #
----------------------------------------------------------------------------<br>
## hash表 ##
Hash表，以键值对的方式存储数据。我们使用Hash表存储表数据key可以存储索引列,value可以存储行记录或者行磁盘地址。Hash表在等值查询时效率很高，时间复杂度为o(1)，但是不支持范围快速查找，范围快速查找只能通过扫描全表的方式<br>

## 二叉查找树 ##
![img](https://deathlimbo.github.io/img/index/1.png)
二叉树的特点：每个节点最多有两个分叉，左子树和右子树顺序左小右大。<br>
这个特点就是为了保证每次查找都可以折半而减少io次数，但是二叉树就是很考验第一个根节点的取值，因为很容易在这个特点下发生“树不分叉了”。<br>
![img](https://deathlimbo.github.io/img/index/2.png)
## 平衡二叉树 ##
平衡二叉树是采用二分法思维，平衡二叉查找树除了具备二叉树的特点，最主要的特征时左右两个子树的层级最多相差1。在插入删除数据时通过左旋/右旋操作保持二叉树的平衡，不会出现左子树很高、右子树很矮的情况。<br>
使用平衡二叉查找树查询的性能接近二分查找法，时间复杂度是O(log2n).<br>
![img](https://deathlimbo.github.io/img/index/1.png)
缺点:<br>
 1、时间复杂度和树高相关。<br>
 2、平衡二叉树不支持范围查询快速查找，范围查询时需要从根节点多次遍历，查询效率不高<br>
## B树:改造二叉树 ##
因为在MySQL的InnoDB存储引擎一次IO会读取的一页（默认一页16K）的数据量，而二叉树一次IO有效数据量只有16字节，空间利用率极低。为了最大化利用一次IO空间，一个简单的想法是在每个节点存储多个元素，在每个节点尽可能多的存储数据。每个节点可以存储1000个索引（16k/16=1000），这样就将二叉树改造成了多叉树，通过增加树的叉树，将树从高瘦变为矮胖。构建1百万条数据，树的高度只需要2层就可以（1000*1000=1百万），也就是说只需要2次磁盘IO就可以查询到数据。磁盘IO次数变少了，查询数据的效率也就提高了。<br>
这种数据结构我们成为B树，B树是一种多叉平衡查找树，有以下主要特点:<br>
    1、B树的节点中存储着多个元素，每个内节点有多个分叉<br>
    2、节点中的元素包含键值和数据，节点中的键值从大到小排列，也就是说，所有的节点都储存数据<br>
    3、父节点的元素不会出现在子节点中<br>
    4、所有的节点都位于同一层，叶节点具有相同的深度，叶节点之间没有指针链接<br>
![img](https://deathlimbo.github.io/img/index/3.png)
B树可以优化的地方:<br>
 1、B树不支持范围查询的快速查找<br>
 2、如果data存储的是行记录，行的大小随着列数的增多，所占空间会变大，这时一个页中可存储的数据量就会变少，树相应就变高
## B+树:改造B树 ##
 B树：非叶子节点和叶子节点都会存储数据。 <br>
 B+树：只有叶子节点才会存储数据，非叶子节点至存储键值。叶子节点之间使用双向指针连接，最底层的叶子节点形成了一个双向有序链表。 <br>
 ![img](https://deathlimbo.github.io/img/index/4.png)
 B+树的最底层叶子节点包含了所有的索引项。从图上可以看到，B+树在查找数据的时候，由于数据都存放在最底层的叶子节点上，所以每次查找都需要检索到叶子节点才能查询到数据。<br>
 所以在需要查询数据的情况下每次的磁盘的IO跟树高有直接的关系，但是从另一方面来说，由于数据都被放到了叶子节点，放索引的磁盘块锁存放的索引数量是会跟这增加的，相对于B树来说，B+树的树高理论上情况下是比B树要矮的。<br>
 也存在索引覆盖查询的情况，在索引中数据满足了当前查询语句所需要的全部数据，此时只需要找到索引即可立刻返回，不需要检索到最底层的叶子节点。<br>
#                                      Mysql的索引实现                          #
----------------------------------------------------------------------------<br>




