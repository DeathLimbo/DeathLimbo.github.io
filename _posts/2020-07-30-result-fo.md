---
layout: post
title: 杂谈-设计异步 RESTful APIs
date: 2020-07-30
categories: 函数总结
tags: [异步,RESTful APIs]
description: 文章金句。
---
# 场景 #
## 常用web场景 ##
一个不同的 Web 应用通常不会遇到需要异步 RESTful API 的场景，它们的交互逻辑固定为：<br>
- 客户端请求 –> 服务端程序与数据库交互 –> 响应客户端。 <br>

### 问题假设 ###
现在假设我们的业务非常的复杂，需要后端进行长时间的处理（比如，五分钟），那么我们应该如何设计 RESTful API 来与客户端进行异步任务交互呢？
- 异步事务过程: <br>
 1、客户端请求 -> 服务端接收到请求 -> 异步启动任务 -> 响应客户端任务已接受 <br>
 2、客户端请求 -> 服务端收到任务进度查询请求 -> 查看任务进度 -> 响应客户端任务的执行状态 <br>

#异步 RESTful 产生问题 #
- 接口幂等性的保证让客户端生成而是服务端分配？ <br>
 1、支持客户端在 POST 请求 Body 中包含一个保证幂等性的唯一标识 <br>
 2、通过先通过一个接口让服务端分配一个异步任务的事务 ID，然后客户端收到此 ID 后凭借此 ID 进行后续操作<br>
    差异:1、第二种 好处在于:服务端完整的掌控的所有的异步事务<br>
                                      差异:1、第二种 好处在于:服务端完整的掌控的所有的异步事务
    ## 场景描述 ##
    客户端 A 和 客户端 B 同时使用了相同的标识符来做幂等性的保证，那么服务端必须鉴别这两个相同的标识是来自不同的客户端实体。这可以通过在请求中增加额外的身份验证来完成，但这进一步增加了服务端的复杂度以及客户端与服务端之间的交互成本。<br>
- 为什么不选择 WebSocket？ <br>

- 服务端的异步任务如何对任务进度进行记录？
- 如何让客户端从请求结果中识别异步任务成功还是失败？
- 如果异步任务失败了，服务端需要对异步任务涉及的资源作何处理？
- ...

# 接口设计 #

